/* お花見アルコールチェッカ ちょっとアレンジ版 (GR-SAKURA限定) */#include <rxduino.h>#include <iodefine_gcc63n.h>int level = 0;double temp = 0.0;// 温度計測void thermo(){	// 温度の計算式は以下のPDFの19ページを参照	// http://japan.renesas.com/media/partner/event/private_2012/forum2012_tokudenkairo.pdf	temp = ( (adc_sample(100) * 3.3 / 4096) - 1.26) / 0.0041 + 25;	// IC自体の発熱もあるので10度ほど低めにみえるようにします。かなりアバウト。	temp = temp - 10.0;	// ~13度 : 緑色点灯	if (temp < 13.0) {		digitalWrite(15, 0);		digitalWrite(16, 0);		digitalWrite(17, 0);		digitalWrite(18, 0);		digitalWrite(19, 1);	}	// 13~18度 : 緑色、黄色点灯	if (temp >= 13.0 and temp < 18.0) {		digitalWrite(15, 0);		digitalWrite(16, 0);		digitalWrite(17, 0);		digitalWrite(18, 1);		digitalWrite(19, 1);	}	// 18~23度 : 緑色、黄色、さくら色1つ点灯	if (temp >= 18.0 and temp < 23.0) {		digitalWrite(15, 0);		digitalWrite(16, 0);		digitalWrite(17, 1);		digitalWrite(18, 1);		digitalWrite(19, 1);	}	// 23~28度 : 緑色、黄色、さくら色2つ点灯	if (temp >= 23.0 and temp < 28.0) {		digitalWrite(15, 0);		digitalWrite(16, 1);		digitalWrite(17, 1);		digitalWrite(18, 1);		digitalWrite(19, 1);	}	// 28度~ : 赤色まですべて点灯(もう夏ですね)	if (temp >= 28.0) {		digitalWrite(15, 1);		digitalWrite(16, 1);		digitalWrite(17, 1);		digitalWrite(18, 1);		digitalWrite(19, 1);	}}// アルコールチェックvoid alcohol(){	// アルコールセンサの値を取得	// 0~1023の範囲	// 個々人の差が大きいと思うので適宜調整してみてください。	level = 1023 - analogRead(A0);	// 0~400 : 全LED消灯	if (level < 400) {		digitalWrite(15, 0);		digitalWrite(16, 0);		digitalWrite(17, 0);		digitalWrite(18, 0);		digitalWrite(19, 0);	}	// 400~500 : 緑色点灯	if (level >= 400 and level < 500) {		digitalWrite(15, 0);		digitalWrite(16, 0);		digitalWrite(17, 0);		digitalWrite(18, 0);		digitalWrite(19, 1);	}	// 500~600 : 黄色点灯	if (level >= 500 and level < 600) {		digitalWrite(15, 0);		digitalWrite(16, 0);		digitalWrite(17, 0);		digitalWrite(18, 1);		digitalWrite(19, 0);	}	// 600~700 : さくら色点灯(1つ)	if (level >= 600 and level < 700) {		digitalWrite(15, 0);		digitalWrite(16, 0);		digitalWrite(17, 1);		digitalWrite(18, 0);		digitalWrite(19, 0);	}	// 700~800 : さくら色点灯(2つ)	if (level >= 700 and level < 800) {		digitalWrite(15, 0);		digitalWrite(16, 1);		digitalWrite(17, 1);		digitalWrite(18, 0);		digitalWrite(19, 0);	}	// 800~1023 : 赤色点灯…泥酔？	if (level >= 800) {		digitalWrite(15, 1);		digitalWrite(16, 0);		digitalWrite(17, 0);		digitalWrite(18, 0);		digitalWrite(19, 0);	}}void setup(){	// LEDの色はお好みで！	pinMode(15, OUTPUT); // A1ピン・赤色	pinMode(16, OUTPUT); // A2ピン・さくら色	pinMode(17, OUTPUT); // A3ピン・さくら色	pinMode(18, OUTPUT); // A4ピン・黄色	pinMode(19, OUTPUT); // A5ピン・緑色	// 基板表面にある水色のスイッチを使います。	pinMode(PIN_SW, INPUT);	// はじめはぜんぶ消灯	digitalWrite(15, 0);	digitalWrite(16, 0);	digitalWrite(17, 0);	digitalWrite(18, 0);	digitalWrite(19, 0);	// ICチップ本体の温度センサを初期化します。	adc_init();	S12AD.ADSSTR23.WORD = 0xff14;}void loop(){	// 水色スイッチの状態をみて温度計測かアルコールチェックか	if (digitalRead(PIN_SW) == 0) {		alcohol();	} else {		thermo();	}	// 100ミリ秒ごと	delay(100);}